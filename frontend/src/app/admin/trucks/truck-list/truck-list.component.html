<div class="truck-list-container">
  <!-- Breadcrumb -->
  <app-breadcrumb [items]="[{ label: 'Trucks', icon: 'local_shipping' }]"></app-breadcrumb>

  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <h1>Truck Management</h1>
      <p class="subtitle">Manage fleet vehicles and their status</p>
    </div>
    <button mat-raised-button color="primary" (click)="createTruck()">
      <mat-icon>add</mat-icon>
      Add Truck
    </button>
  </div>

  <!-- Filters -->
  <mat-card class="filters-card">
    <div class="filters-row">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search</mat-label>
        <input matInput
          placeholder="Search by truck ID, license plate, driver..."
          [(ngModel)]="searchTerm"
          (input)="onSearch()">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Status</mat-label>
        <mat-select [(ngModel)]="selectedStatus" (selectionChange)="onFilterChange()">
          <mat-option [value]="null">All Statuses</mat-option>
          @for (status of statuses; track status) {
            <mat-option [value]="status.value">
              {{ status.label }}
            </mat-option>
          }
        </mat-select>
      </mat-form-field>

      @if (hasFilters()) {
        <button mat-stroked-button (click)="clearFilters()">
          <mat-icon>clear</mat-icon>
          Clear
        </button>
      }
    </div>
  </mat-card>

  <!-- Trucks Table -->
  <mat-card class="table-card">
    <app-data-table
      [columns]="columns"
      [data]="trucks()"
      [totalElements]="totalElements()"
      [pageSize]="pageSize"
      [pageIndex]="pageIndex"
      [isLoading]="loading()"
      [searchable]="false"
      [showActions]="false"
      [rowClickable]="true"
      (pageChange)="onPageChange($event)"
      (rowClicked)="onRowClick($event)">
    </app-data-table>

    <!-- Actions column rendered separately -->
    <ng-template #actionsTemplate let-truck>
      <button mat-icon-button [matMenuTriggerFor]="menu" (click)="$event.stopPropagation()">
        <mat-icon>more_vert</mat-icon>
      </button>
      <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="editTruck(truck)">
          <mat-icon>edit</mat-icon>
          <span>Edit</span>
        </button>
        @if (truck.status !== 'OUT_OF_SERVICE') {
          <button mat-menu-item
            (click)="confirmOutOfService(truck)">
            <mat-icon color="warn">block</mat-icon>
            <span>Mark Out of Service</span>
          </button>
        }
        @if (truck.status === 'OUT_OF_SERVICE') {
          <button mat-menu-item
            (click)="confirmActivate(truck)">
            <mat-icon color="primary">check_circle</mat-icon>
            <span>Activate</span>
          </button>
        }
      </mat-menu>
    </ng-template>
  </mat-card>
</div>
