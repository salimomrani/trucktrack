<div class="p-6 space-y-6">
  <!-- Breadcrumb -->
  <app-breadcrumb [items]="[{ label: 'Configuration', icon: 'settings' }]"></app-breadcrumb>

  <!-- Header -->
  <div class="mb-6">
    <h1 class="text-2xl font-semibold text-gray-800">System Configuration</h1>
    <p class="text-gray-500">Manage application settings</p>
  </div>

  @if (loading()) {
    <div class="flex flex-col items-center justify-center py-12">
      <div class="w-12 h-12 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mb-4"></div>
      <p class="text-gray-500">Loading configuration...</p>
    </div>
  } @else if (error()) {
    <div class="bg-white rounded-lg shadow-card p-6">
      <div class="flex flex-col items-center text-center">
        <span class="material-icons text-4xl text-danger-500 mb-4">error</span>
        <p class="text-gray-700 mb-4">{{ error() }}</p>
        <button
          type="button"
          class="px-4 py-2 text-primary-600 hover:bg-primary-50 rounded-md transition-colors"
          (click)="loadConfig()">
          Retry
        </button>
      </div>
    </div>
  } @else {
    <!-- Configuration Categories -->
    @for (category of categories(); track category) {
      <div class="bg-white rounded-lg shadow-card">
        <div class="p-4 border-b border-gray-100 flex items-center gap-4">
          <div class="flex items-center justify-center w-10 h-10 rounded-full bg-primary-50">
            <span class="material-icons text-primary-600">{{ getCategoryIcon(category) }}</span>
          </div>
          <div>
            <h2 class="text-lg font-semibold text-gray-800">{{ category }}</h2>
            <p class="text-sm text-gray-500">{{ getCategoryDescription(category) }}</p>
          </div>
        </div>
        <div class="p-4 space-y-2">
          @for (config of getConfigsByCategory(category); track config.key; let idx = $index) {
            <details class="group border border-gray-200 rounded-lg">
              <summary class="flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50 rounded-lg">
                <div class="flex-1">
                  <span class="font-medium text-gray-800">{{ config.key }}</span>
                  <span class="ml-4 text-sm text-gray-500">{{ config.value }}</span>
                </div>
                <span class="material-icons text-gray-400 transition-transform group-open:rotate-180">expand_more</span>
              </summary>
              <div class="p-4 pt-0 space-y-4">
                <p class="text-sm text-gray-600">{{ config.description }}</p>

                <!-- Value Input -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Value</label>
                  @if (config.valueType === 'BOOLEAN') {
                    <select
                      class="w-full max-w-md px-3 py-2 border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                      [(ngModel)]="editValues[config.key]">
                      <option value="true">True</option>
                      <option value="false">False</option>
                    </select>
                  } @else {
                    <input
                      [type]="config.valueType === 'INTEGER' ? 'number' : 'text'"
                      class="w-full max-w-md px-3 py-2 border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                      [(ngModel)]="editValues[config.key]">
                  }
                </div>

                <!-- Reason Input -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Reason for change (optional)</label>
                  <input
                    type="text"
                    class="w-full max-w-md px-3 py-2 border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                    [(ngModel)]="editReasons[config.key]"
                    placeholder="Enter reason...">
                </div>

                <!-- Actions -->
                <div class="flex items-center gap-3">
                  <button
                    type="button"
                    class="px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-md transition-colors"
                    (click)="resetValue(config)">
                    Reset
                  </button>
                  <button
                    type="button"
                    class="px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                    [disabled]="editValues[config.key] === config.value"
                    (click)="saveConfig(config)">
                    Save
                  </button>
                </div>

                <!-- Meta Information -->
                <div class="flex flex-wrap items-center gap-4 text-xs text-gray-500 pt-2 border-t border-gray-100">
                  <span>Type: {{ config.valueType }}</span>
                  <span>Version: {{ config.version }}</span>
                  @if (config.updatedBy) {
                    <span>Last updated by {{ config.updatedBy }}</span>
                  }
                </div>
              </div>
            </details>
          }
        </div>
      </div>
    }

    @if (configs().length === 0) {
      <div class="bg-white rounded-lg shadow-card p-8">
        <div class="flex flex-col items-center text-center text-gray-400">
          <span class="material-icons text-5xl mb-4">settings</span>
          <p class="text-lg font-medium text-gray-600">No configuration settings found.</p>
          <p class="text-sm">Configuration will be populated when the system initializes.</p>
        </div>
      </div>
    }
  }
</div>
