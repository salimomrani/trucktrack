<div class="config-container">
  <!-- Breadcrumb -->
  <app-breadcrumb [items]="[{ label: 'Configuration', icon: 'settings' }]"></app-breadcrumb>

  <!-- Header -->
  <div class="page-header">
    <h1>System Configuration</h1>
    <p class="subtitle">Manage application settings</p>
  </div>

  @if (loading()) {
    <div class="loading-container">
      <mat-spinner diameter="48"></mat-spinner>
    </div>
  } @else if (error()) {
    <mat-card class="error-card">
      <mat-card-content>
        <mat-icon>error</mat-icon>
        <p>{{ error() }}</p>
        <button mat-button color="primary" (click)="loadConfig()">Retry</button>
      </mat-card-content>
    </mat-card>
  } @else {
    <!-- Configuration Categories -->
    @for (category of categories(); track category) {
      <mat-card class="config-section">
        <mat-card-header>
          <mat-icon mat-card-avatar [class]="'config-icon ' + category.toLowerCase()">
            {{ getCategoryIcon(category) }}
          </mat-icon>
          <mat-card-title>{{ category }}</mat-card-title>
          <mat-card-subtitle>{{ getCategoryDescription(category) }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <mat-accordion>
            @for (config of getConfigsByCategory(category); track config.key) {
              <mat-expansion-panel>
                <mat-expansion-panel-header>
                  <mat-panel-title>{{ config.key }}</mat-panel-title>
                  <mat-panel-description>{{ config.value }}</mat-panel-description>
                </mat-expansion-panel-header>

                <div class="config-detail">
                  <p class="config-description">{{ config.description }}</p>

                  <mat-form-field appearance="outline" class="config-input">
                    <mat-label>Value</mat-label>
                    @if (config.valueType === 'BOOLEAN') {
                      <mat-select [(ngModel)]="editValues[config.key]">
                        <mat-option value="true">True</mat-option>
                        <mat-option value="false">False</mat-option>
                      </mat-select>
                    } @else {
                      <input matInput [(ngModel)]="editValues[config.key]"
                             [type]="config.valueType === 'INTEGER' ? 'number' : 'text'">
                    }
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="config-input">
                    <mat-label>Reason for change (optional)</mat-label>
                    <input matInput [(ngModel)]="editReasons[config.key]">
                  </mat-form-field>

                  <div class="config-actions">
                    <button mat-button (click)="resetValue(config)">Reset</button>
                    <button mat-raised-button color="primary"
                            [disabled]="editValues[config.key] === config.value"
                            (click)="saveConfig(config)">
                      Save
                    </button>
                  </div>

                  <div class="config-meta">
                    <span>Type: {{ config.valueType }}</span>
                    <span>Version: {{ config.version }}</span>
                    @if (config.updatedBy) {
                      <span>Last updated by {{ config.updatedBy }}</span>
                    }
                  </div>
                </div>
              </mat-expansion-panel>
            }
          </mat-accordion>
        </mat-card-content>
      </mat-card>
    }

    @if (configs().length === 0) {
      <mat-card class="empty-card">
        <mat-card-content>
          <mat-icon>settings</mat-icon>
          <p>No configuration settings found.</p>
          <p class="hint">Configuration will be populated when the system initializes.</p>
        </mat-card-content>
      </mat-card>
    }
  }
</div>
