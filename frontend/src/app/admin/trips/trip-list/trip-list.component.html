<div class="p-6">
  <!-- Breadcrumb -->
  <app-breadcrumb [items]="[{ label: 'Trips', icon: 'route' }]"></app-breadcrumb>

  <!-- Header -->
  <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
    <div>
      <h1 class="text-2xl font-semibold text-gray-800">Trip Management</h1>
      <p class="text-gray-500 mt-1">Create, assign, and monitor trips</p>
    </div>
    <div class="flex items-center gap-4">
      <!-- Auto-refresh Toggle -->
      <label class="group relative inline-flex items-center gap-2 cursor-pointer">
        <input
          type="checkbox"
          class="sr-only peer"
          [checked]="autoRefreshEnabled"
          (change)="toggleAutoRefresh()">
        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600"></div>
        <span class="text-sm font-medium text-gray-700">Auto-refresh</span>
        <!-- Tooltip -->
        <span class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 text-xs font-medium text-white bg-gray-800 rounded opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-50">
          Auto-refresh every 10 seconds
        </span>
      </label>
      <button
        type="button"
        class="inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors"
        (click)="createTrip()">
        <span class="material-icons text-lg">add</span>
        Create Trip
      </button>
    </div>
  </div>

  <!-- Status Summary Cards -->
  <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
    @for (status of statuses; track status.value) {
      <div
        class="bg-white rounded-lg shadow-card p-4 cursor-pointer transition-all hover:shadow-lg"
        [class.ring-2]="selectedStatus === status.value"
        [class.ring-primary-500]="selectedStatus === status.value"
        [class.bg-primary-50]="isActiveStatus(status.value)"
        (click)="onStatusChipClick(status.value)">
        <div class="flex items-center gap-3">
          <div
            class="flex items-center justify-center w-10 h-10 rounded-full"
            [style.background-color]="status.color + '20'">
            <span class="material-icons text-xl" [style.color]="status.color">{{ status.icon }}</span>
          </div>
          <div>
            <div class="text-xl font-bold text-gray-800">{{ getStatusCount(status.value) }}</div>
            <div class="text-xs text-gray-500">{{ status.label }}</div>
          </div>
        </div>
      </div>
    }
  </div>

  <!-- Filters -->
  <div class="bg-white rounded-lg shadow-card p-4 mb-6">
    <div class="flex flex-wrap items-end gap-4">
      <!-- Search Field -->
      <div class="flex-1 min-w-[200px]">
        <label class="block text-sm font-medium text-gray-700 mb-1">Search</label>
        <div class="relative">
          <input
            type="text"
            class="w-full px-3 py-2 pl-10 border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
            placeholder="Search by origin, destination..."
            [(ngModel)]="searchTerm"
            (input)="onSearch()">
          <span class="material-icons absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xl">search</span>
        </div>
      </div>

      <!-- Status Filter -->
      <div class="w-40">
        <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
        <select
          class="w-full px-3 py-2 border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
          [(ngModel)]="selectedStatus"
          (ngModelChange)="onFilterChange()">
          <option [ngValue]="null">All Statuses</option>
          @for (status of statuses; track status.value) {
            <option [ngValue]="status.value">{{ status.label }}</option>
          }
        </select>
      </div>

      <!-- Date Range Pickers -->
      <div class="w-40">
        <label class="block text-sm font-medium text-gray-700 mb-1">From</label>
        <input
          type="date"
          class="w-full px-3 py-2 border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
          [ngModel]="startDate | date:'yyyy-MM-dd'"
          (ngModelChange)="onStartDateChange($event)">
      </div>

      <div class="w-40">
        <label class="block text-sm font-medium text-gray-700 mb-1">To</label>
        <input
          type="date"
          class="w-full px-3 py-2 border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
          [ngModel]="endDate | date:'yyyy-MM-dd'"
          (ngModelChange)="onEndDateChange($event)">
      </div>

      @if (hasFilters()) {
        <button
          type="button"
          class="inline-flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors"
          (click)="clearFilters()">
          <span class="material-icons text-lg">clear</span>
          Clear
        </button>
      }

      <button
        type="button"
        class="group relative inline-flex items-center justify-center w-10 h-10 rounded-full text-gray-500 hover:bg-gray-100 transition-colors"
        (click)="loadTrips()">
        <span class="material-icons">refresh</span>
        <!-- Tooltip -->
        <span class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 text-xs font-medium text-white bg-gray-800 rounded opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-50">
          Refresh
        </span>
      </button>
    </div>
  </div>

  <!-- Trips Table -->
  <div class="bg-white rounded-lg shadow-card">
    <app-data-table
      [columns]="columns"
      [data]="trips()"
      [totalElements]="totalElements()"
      [pageSize]="pageSize"
      [pageIndex]="pageIndex"
      [isLoading]="loading()"
      [searchable]="false"
      [showActions]="false"
      [rowClickable]="true"
      (pageChange)="onPageChange($event)"
      (rowClicked)="onRowClick($event)">
    </app-data-table>
  </div>
</div>
