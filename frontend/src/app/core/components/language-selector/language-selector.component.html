<div class="language-selector" (clickOutside)="closeDropdown()">
  <button
    type="button"
    class="language-btn"
    (click)="toggleDropdown()"
    [attr.aria-expanded]="isOpen()"
    aria-haspopup="listbox"
    aria-label="Select language">
    <span class="flag">{{ languageFlags[currentLanguage()] }}</span>
    <span class="code">{{ currentLanguage().toUpperCase() }}</span>
    <span class="material-icons chevron" [class.open]="isOpen()">expand_more</span>
  </button>

  @if (isOpen()) {
    <ul class="language-dropdown" role="listbox">
      @for (lang of languages(); track lang) {
        <li
          role="option"
          class="language-option"
          [class.active]="lang === currentLanguage()"
          [attr.aria-selected]="lang === currentLanguage()"
          (click)="selectLanguage(lang)">
          <span class="flag">{{ languageFlags[lang] }}</span>
          <span class="name">{{ languageNames()?.[lang] }}</span>
          @if (lang === currentLanguage()) {
            <span class="material-icons check">check</span>
          }
        </li>
      }
    </ul>
  }
</div>
