<div class="p-6">
  <!-- Alert Rules Management Section (T162) -->
  <app-card title="Alert Rules" class="mb-6" [padding]="'none'">
    <div header class="flex items-center gap-2">
      <span class="material-icons text-gray-600 dark:text-gray-300">rule</span>
    </div>
    <button header
      type="button"
      class="inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors"
      (click)="toggleRuleForm()"
      [attr.aria-expanded]="showRuleForm()"
      aria-controls="alert-rule-form">
      <span class="material-icons">{{ showRuleForm() ? 'close' : 'add' }}</span>
      {{ showRuleForm() ? 'Cancel' : 'New Rule' }}
    </button>

    <div class="p-4">
      <!-- Alert Rule Form -->
      @if (showRuleForm()) {
        <div class="mb-6 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg" id="alert-rule-form" role="region" aria-label="Create new alert rule form">
          <form [formGroup]="alertRuleForm" (ngSubmit)="createAlertRule()" aria-label="Alert rule configuration">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <!-- Rule Name -->
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">Rule Name *</label>
                <input
                  type="text"
                  formControlName="name"
                  class="w-full px-3 py-2 border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                  placeholder="e.g., Speed Alert"
                  aria-required="true"
                  aria-describedby="name-hint">
                <p id="name-hint" class="mt-1 text-xs text-gray-500 dark:text-gray-400">Enter a descriptive name for this alert rule</p>
                @if (alertRuleForm.get('name')?.hasError('required') && alertRuleForm.get('name')?.touched) {
                  <p class="mt-1 text-xs text-danger-500">Name is required</p>
                }
                @if (alertRuleForm.get('name')?.hasError('minlength')) {
                  <p class="mt-1 text-xs text-danger-500">Name must be at least 3 characters</p>
                }
              </div>

              <!-- Rule Type -->
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">Rule Type *</label>
                <select
                  formControlName="ruleType"
                  class="w-full px-3 py-2 border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                  aria-required="true"
                  aria-describedby="type-hint">
                  @for (type of ruleTypes; track type.value) {
                    <option [value]="type.value">{{ type.label }}</option>
                  }
                </select>
                <p id="type-hint" class="mt-1 text-xs text-gray-500 dark:text-gray-400">Select the type of condition to monitor</p>
              </div>
            </div>

            <!-- Description -->
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">Description (optional)</label>
              <textarea
                formControlName="description"
                rows="2"
                class="w-full px-3 py-2 border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                placeholder="Describe this alert rule"
                aria-describedby="desc-hint"></textarea>
              <p id="desc-hint" class="mt-1 text-xs text-gray-500 dark:text-gray-400">Optional description to explain this rule's purpose</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
              <!-- Threshold Value -->
              @if (requiresThreshold(alertRuleForm.get('ruleType')?.value)) {
                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">{{ getThresholdLabel(alertRuleForm.get('ruleType')?.value) }}</label>
                  <input
                    type="number"
                    formControlName="thresholdValue"
                    min="0"
                    class="w-full px-3 py-2 border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                    aria-describedby="threshold-hint">
                  <p id="threshold-hint" class="mt-1 text-xs text-gray-500 dark:text-gray-400">Set the threshold value to trigger the alert</p>
                </div>
              }

              <!-- Geofence Selection -->
              @if (requiresGeofence(alertRuleForm.get('ruleType')?.value)) {
                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">Select Geofence</label>
                  <select
                    formControlName="geofenceId"
                    class="w-full px-3 py-2 border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                    aria-describedby="geofence-hint">
                    <option value="">Select a geofence</option>
                    @for (geofence of geofences(); track geofence.id) {
                      <option [value]="geofence.id">{{ geofence.name }}</option>
                    }
                  </select>
                  <p id="geofence-hint" class="mt-1 text-xs text-gray-500 dark:text-gray-400">Select an existing geofence to monitor</p>
                </div>
              }

              <!-- Enabled Toggle -->
              <div class="flex items-center">
                <label class="inline-flex items-center cursor-pointer">
                  <input
                    type="checkbox"
                    formControlName="isEnabled"
                    class="sr-only peer">
                  <div class="w-11 h-6 bg-gray-200 dark:bg-gray-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 dark:after:border-gray-500 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600 relative"></div>
                  <span class="ml-3 text-sm font-medium text-gray-700 dark:text-gray-200">Enabled</span>
                </label>
              </div>
            </div>

            <div class="flex justify-end gap-3" role="group" aria-label="Form actions">
              <button
                type="button"
                class="px-4 py-2 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-md transition-colors"
                (click)="toggleRuleForm()"
                aria-label="Cancel creating alert rule">
                Cancel
              </button>
              <button
                type="submit"
                class="inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                [disabled]="alertRuleForm.invalid || isCreatingRule()"
                [attr.aria-busy]="isCreatingRule()"
                aria-label="Create new alert rule">
                @if (isCreatingRule()) {
                  <div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin" aria-label="Creating rule"></div>
                } @else {
                  <span class="material-icons text-lg">add</span>
                }
                Create Rule
              </button>
            </div>
          </form>
        </div>
        <hr class="border-gray-200 dark:border-gray-700 mb-4">
      }

      <!-- Existing Alert Rules List -->
      <div class="space-y-3" role="list" aria-label="Configured alert rules">
        @if (alertRules().length === 0) {
          <app-empty-state
            preset="alerts"
            title="Aucune règle d'alerte"
            message="Créez votre première règle pour commencer à recevoir des notifications."
            actionText="Créer une règle"
            actionIcon="add"
            size="sm"
            (action)="toggleRuleForm()"
          />
        } @else {
          @for (rule of alertRules(); track rule.id) {
            <div
              class="flex items-center gap-4 p-4 rounded-lg border transition-colors"
              [class.bg-gray-50]="!rule.isEnabled"
              [class.dark:bg-gray-700]="!rule.isEnabled"
              [class.border-gray-200]="rule.isEnabled"
              [class.dark:border-gray-600]="rule.isEnabled"
              [class.border-gray-100]="!rule.isEnabled"
              [class.dark:border-gray-700]="!rule.isEnabled"
              [class.opacity-60]="!rule.isEnabled"
              role="listitem"
              [attr.aria-label]="rule.name + ' - ' + rule.ruleType + (rule.isEnabled ? ' (enabled)' : ' (disabled)')">
              <div class="flex items-center justify-center w-10 h-10 rounded-full bg-primary-50 dark:bg-primary-900/30" aria-hidden="true">
                <span class="material-icons text-primary-600 dark:text-primary-400">{{ getRuleTypeIcon(rule.ruleType) }}</span>
              </div>
              <div class="flex-1 min-w-0">
                <div class="font-medium text-gray-800 dark:text-gray-100">{{ rule.name }}</div>
                <div class="flex items-center gap-2 mt-1">
                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">{{ rule.ruleType }}</span>
                  @if (rule.thresholdValue) {
                    <span class="text-xs text-gray-500 dark:text-gray-400">Threshold: {{ rule.thresholdValue }}</span>
                  }
                </div>
              </div>
              <div class="flex items-center gap-2" role="group" [attr.aria-label]="'Actions for ' + rule.name">
                <label class="inline-flex items-center cursor-pointer">
                  <input
                    type="checkbox"
                    [checked]="rule.isEnabled"
                    (change)="toggleRuleEnabled(rule)"
                    class="sr-only peer"
                    [attr.aria-label]="(rule.isEnabled ? 'Disable' : 'Enable') + ' rule ' + rule.name">
                  <div class="w-9 h-5 bg-gray-200 dark:bg-gray-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 dark:after:border-gray-500 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-primary-600 relative"></div>
                </label>
                <button
                  type="button"
                  class="p-2 text-danger-500 dark:text-danger-400 hover:bg-danger-50 dark:hover:bg-danger-900/30 rounded-full transition-colors"
                  (click)="deleteAlertRule(rule)"
                  [attr.aria-label]="'Delete rule ' + rule.name">
                  <span class="material-icons">delete</span>
                </button>
              </div>
            </div>
          }
        }
      </div>
    </div>
  </app-card>

  <!-- Stats Cards -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
    <app-card [padding]="'sm'">
      <div class="flex items-center gap-3">
        <div class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700">
          <span class="material-icons text-gray-600 dark:text-gray-300">notifications</span>
        </div>
        <div>
          <div class="text-2xl font-bold text-gray-800 dark:text-gray-100">{{ stats().total }}</div>
          <div class="text-xs text-gray-500 dark:text-gray-400">Total Alerts</div>
        </div>
      </div>
    </app-card>

    <app-card [padding]="'sm'" class="relative">
      @if (stats().unread > 0) {
        <span class="absolute -top-2 -right-2 flex items-center justify-center min-w-[20px] h-5 px-1.5 text-xs font-bold text-white bg-warning-500 rounded-full z-10">{{ stats().unread }}</span>
      }
      <div class="flex items-center gap-3">
        <div class="flex items-center justify-center w-10 h-10 rounded-full bg-warning-50 dark:bg-warning-900/30">
          <span class="material-icons text-warning-600 dark:text-warning-400">mark_email_unread</span>
        </div>
        <div>
          <div class="text-2xl font-bold text-gray-800 dark:text-gray-100">{{ stats().unread }}</div>
          <div class="text-xs text-gray-500 dark:text-gray-400">Unread</div>
        </div>
      </div>
    </app-card>

    <app-card [padding]="'sm'">
      <div class="flex items-center gap-3">
        <div class="flex items-center justify-center w-10 h-10 rounded-full bg-danger-50 dark:bg-danger-900/30">
          <span class="material-icons text-danger-600 dark:text-danger-400">error</span>
        </div>
        <div>
          <div class="text-2xl font-bold text-gray-800 dark:text-gray-100">{{ stats().critical }}</div>
          <div class="text-xs text-gray-500 dark:text-gray-400">Critical</div>
        </div>
      </div>
    </app-card>

    <app-card [padding]="'sm'">
      <div class="flex items-center gap-3">
        <div class="flex items-center justify-center w-10 h-10 rounded-full bg-warning-50 dark:bg-warning-900/30">
          <span class="material-icons text-warning-600 dark:text-warning-400">warning</span>
        </div>
        <div>
          <div class="text-2xl font-bold text-gray-800 dark:text-gray-100">{{ stats().warning }}</div>
          <div class="text-xs text-gray-500 dark:text-gray-400">Warning</div>
        </div>
      </div>
    </app-card>
  </div>

  <!-- Filters and Actions -->
  <app-card class="mb-6">
    <div class="flex flex-wrap items-center justify-between gap-4">
      <div class="flex flex-wrap items-center gap-2">
        <button
          type="button"
          class="px-3 py-1.5 rounded-md text-sm font-medium transition-colors"
          [class.bg-primary-100]="selectedSeverity() === null"
          [class.dark:bg-primary-900]="selectedSeverity() === null"
          [class.text-primary-700]="selectedSeverity() === null"
          [class.dark:text-primary-300]="selectedSeverity() === null"
          [class.text-gray-600]="selectedSeverity() !== null"
          [class.dark:text-gray-300]="selectedSeverity() !== null"
          [class.hover:bg-gray-100]="selectedSeverity() !== null"
          [class.dark:hover:bg-gray-700]="selectedSeverity() !== null"
          (click)="filterBySeverity(null)">
          All
        </button>
        <button
          type="button"
          class="inline-flex items-center gap-1 px-3 py-1.5 rounded-md text-sm font-medium transition-colors"
          [class.bg-danger-100]="selectedSeverity() === 'CRITICAL'"
          [class.dark:bg-danger-900]="selectedSeverity() === 'CRITICAL'"
          [class.text-danger-700]="selectedSeverity() === 'CRITICAL'"
          [class.dark:text-danger-300]="selectedSeverity() === 'CRITICAL'"
          [class.text-gray-600]="selectedSeverity() !== 'CRITICAL'"
          [class.dark:text-gray-300]="selectedSeverity() !== 'CRITICAL'"
          [class.hover:bg-gray-100]="selectedSeverity() !== 'CRITICAL'"
          [class.dark:hover:bg-gray-700]="selectedSeverity() !== 'CRITICAL'"
          (click)="filterBySeverity('CRITICAL')">
          <span class="material-icons text-base">error</span>
          Critical
        </button>
        <button
          type="button"
          class="inline-flex items-center gap-1 px-3 py-1.5 rounded-md text-sm font-medium transition-colors"
          [class.bg-warning-100]="selectedSeverity() === 'WARNING'"
          [class.dark:bg-warning-900]="selectedSeverity() === 'WARNING'"
          [class.text-warning-700]="selectedSeverity() === 'WARNING'"
          [class.dark:text-warning-300]="selectedSeverity() === 'WARNING'"
          [class.text-gray-600]="selectedSeverity() !== 'WARNING'"
          [class.dark:text-gray-300]="selectedSeverity() !== 'WARNING'"
          [class.hover:bg-gray-100]="selectedSeverity() !== 'WARNING'"
          [class.dark:hover:bg-gray-700]="selectedSeverity() !== 'WARNING'"
          (click)="filterBySeverity('WARNING')">
          <span class="material-icons text-base">warning</span>
          Warning
        </button>
        <button
          type="button"
          class="inline-flex items-center gap-1 px-3 py-1.5 rounded-md text-sm font-medium transition-colors"
          [class.bg-primary-100]="selectedSeverity() === 'INFO'"
          [class.dark:bg-primary-900]="selectedSeverity() === 'INFO'"
          [class.text-primary-700]="selectedSeverity() === 'INFO'"
          [class.dark:text-primary-300]="selectedSeverity() === 'INFO'"
          [class.text-gray-600]="selectedSeverity() !== 'INFO'"
          [class.dark:text-gray-300]="selectedSeverity() !== 'INFO'"
          [class.hover:bg-gray-100]="selectedSeverity() !== 'INFO'"
          [class.dark:hover:bg-gray-700]="selectedSeverity() !== 'INFO'"
          (click)="filterBySeverity('INFO')">
          <span class="material-icons text-base">info</span>
          Info
        </button>
      </div>

      <div class="flex items-center gap-3">
        <button
          type="button"
          class="inline-flex items-center gap-2 px-3 py-1.5 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-sm"
          (click)="toggleShowRead()">
          <span class="material-icons text-base">{{ showRead() ? 'visibility_off' : 'visibility' }}</span>
          {{ showRead() ? 'Hide' : 'Show' }} Read
        </button>
        <button
          type="button"
          class="inline-flex items-center gap-2 px-3 py-1.5 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed"
          (click)="markAllAsRead()"
          [disabled]="stats().unread === 0">
          <span class="material-icons text-base">done_all</span>
          Mark All Read
        </button>
      </div>
    </div>
  </app-card>

  <!-- Notifications List Header with Count -->
  <div class="flex items-center gap-2 mb-4">
    <span class="material-icons text-gray-600 dark:text-gray-300">notifications</span>
    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100">Recent Notifications</h3>
    @if (totalNotifications() > 0) {
      <span class="text-sm text-gray-500 dark:text-gray-400">({{ filteredNotifications().length }} of {{ totalNotifications() }})</span>
    }
  </div>

  <!-- Notifications List -->
  <div class="space-y-3" #notificationList role="list" aria-label="Notifications list">
    @if (isLoading()) {
      <div class="flex flex-col items-center justify-center py-12" role="status" aria-live="polite">
        <div class="w-8 h-8 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mb-3" aria-label="Loading notifications"></div>
        <p class="text-gray-500 dark:text-gray-400">Loading notifications...</p>
      </div>
    } @else if (filteredNotifications().length === 0) {
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-card" role="status" aria-live="polite">
        <app-empty-state
          preset="notifications"
          size="md"
        />
      </div>
    } @else {
      @for (notification of filteredNotifications(); track notification.id; let i = $index) {
        <div
          class="bg-white dark:bg-gray-800 rounded-lg shadow-card p-4 border-l-4 transition-colors"
          [class.border-danger-500]="notification.severity === 'CRITICAL'"
          [class.border-warning-500]="notification.severity === 'WARNING'"
          [class.border-primary-500]="notification.severity === 'INFO'"
          [class.bg-gray-50]="notification.isRead"
          [class.dark:bg-gray-700]="notification.isRead"
          role="listitem"
          tabindex="0"
          [attr.aria-label]="getNotificationAriaLabel(notification)"
          (keydown)="onNotificationKeydown($event, notification)">
          <div class="flex gap-4">
            <!-- Severity Icon -->
            <div
              class="flex-shrink-0 flex items-center justify-center w-10 h-10 rounded-full"
              [class.bg-danger-100]="notification.severity === 'CRITICAL'"
              [class.dark:bg-danger-900/30]="notification.severity === 'CRITICAL'"
              [class.bg-warning-100]="notification.severity === 'WARNING'"
              [class.dark:bg-warning-900/30]="notification.severity === 'WARNING'"
              [class.bg-primary-100]="notification.severity === 'INFO'"
              [class.dark:bg-primary-900/30]="notification.severity === 'INFO'"
              aria-hidden="true">
              <span
                class="material-icons"
                [class.text-danger-600]="notification.severity === 'CRITICAL'"
                [class.dark:text-danger-400]="notification.severity === 'CRITICAL'"
                [class.text-warning-600]="notification.severity === 'WARNING'"
                [class.dark:text-warning-400]="notification.severity === 'WARNING'"
                [class.text-primary-600]="notification.severity === 'INFO'"
                [class.dark:text-primary-400]="notification.severity === 'INFO'">
                {{ getSeverityIcon(notification.severity) }}
              </span>
            </div>

            <!-- Content -->
            <div class="flex-1 min-w-0">
              <div class="flex items-start justify-between gap-2">
                <div class="flex items-center gap-2">
                  <span class="material-icons text-gray-400 dark:text-gray-500 text-base" aria-hidden="true">{{ getTypeIcon(notification.notificationType) }}</span>
                  <strong class="text-gray-800 dark:text-gray-100">{{ notification.title }}</strong>
                  @if (!notification.isRead) {
                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-primary-100 dark:bg-primary-900/40 text-primary-700 dark:text-primary-300" aria-label="Unread notification">New</span>
                  }
                </div>
                <span class="text-xs text-gray-400 dark:text-gray-500 whitespace-nowrap">{{ formatDate(notification.triggeredAt) }}</span>
              </div>

              <p class="text-sm text-gray-600 dark:text-gray-300 mt-1">{{ notification.message }}</p>

              <div class="flex items-center gap-2 mt-2">
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">{{ notification.truckId }}</span>
                <span
                  class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium"
                  [class.bg-danger-100]="notification.severity === 'CRITICAL'"
                  [class.dark:bg-danger-900/40]="notification.severity === 'CRITICAL'"
                  [class.text-danger-700]="notification.severity === 'CRITICAL'"
                  [class.dark:text-danger-300]="notification.severity === 'CRITICAL'"
                  [class.bg-warning-100]="notification.severity === 'WARNING'"
                  [class.dark:bg-warning-900/40]="notification.severity === 'WARNING'"
                  [class.text-warning-700]="notification.severity === 'WARNING'"
                  [class.dark:text-warning-300]="notification.severity === 'WARNING'"
                  [class.bg-primary-100]="notification.severity === 'INFO'"
                  [class.dark:bg-primary-900/40]="notification.severity === 'INFO'"
                  [class.text-primary-700]="notification.severity === 'INFO'"
                  [class.dark:text-primary-300]="notification.severity === 'INFO'">
                  {{ notification.severity }}
                </span>
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">{{ notification.notificationType }}</span>
              </div>
            </div>

            <!-- Actions -->
            <div class="flex-shrink-0 flex items-start gap-1" role="group" [attr.aria-label]="'Actions for notification: ' + notification.title">
              @if (notification.latitude && notification.longitude) {
                <button
                  type="button"
                  class="p-2 text-primary-600 dark:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/30 rounded-full transition-colors"
                  (click)="viewOnMap(notification)"
                  [attr.aria-label]="'View ' + notification.title + ' on map'">
                  <span class="material-icons">map</span>
                </button>
              }
              @if (!notification.isRead) {
                <button
                  type="button"
                  class="p-2 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors"
                  (click)="markAsRead(notification)"
                  [attr.aria-label]="'Mark ' + notification.title + ' as read'">
                  <span class="material-icons">mark_email_read</span>
                </button>
              }
            </div>
          </div>
        </div>
      }

      <!-- Infinite Scroll Sentinel & Loading More Indicator -->
      <div id="scroll-sentinel" class="py-4">
        @if (isLoadingMore()) {
          <div class="flex items-center justify-center gap-3" role="status" aria-live="polite">
            <div class="w-6 h-6 border-3 border-primary-600 border-t-transparent rounded-full animate-spin" aria-label="Loading more notifications"></div>
            <span class="text-gray-500 dark:text-gray-400">Loading more notifications...</span>
          </div>
        } @else if (hasMorePages()) {
          <button
            type="button"
            class="w-full inline-flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
            (click)="loadMoreNotifications()">
            <span class="material-icons">expand_more</span>
            Load More
          </button>
        } @else if (filteredNotifications().length > 0) {
          <div class="flex items-center justify-center gap-2 text-gray-400 dark:text-gray-500">
            <span class="material-icons">check_circle</span>
            <span>You've reached the end</span>
          </div>
        }
      </div>
    }
  </div>
</div>
