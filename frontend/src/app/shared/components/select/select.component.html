<div class="relative">
  <!-- Label -->
  @if (label()) {
    <label [for]="selectId" [class]="getLabelClasses()">
      {{ label() }}
    </label>
  }

  <!-- Trigger button -->
  <button
    type="button"
    [id]="selectId"
    [disabled]="disabled()"
    [class]="getTriggerClasses()"
    [attr.aria-expanded]="isOpen()"
    [attr.aria-haspopup]="true"
    [attr.aria-invalid]="error() ? 'true' : null"
    (click)="toggleDropdown()">

    <span class="flex items-center justify-between">
      <!-- Selected value or placeholder -->
      <span [class]="getDisplayText() ? 'text-gray-800' : 'text-gray-400'">
        {{ getDisplayText() || placeholder() }}
      </span>

      <!-- Chevron icon -->
      <span class="material-icons text-gray-400 transition-transform duration-150"
            [class.rotate-180]="isOpen()">
        expand_more
      </span>
    </span>
  </button>

  <!-- Dropdown -->
  @if (isOpen()) {
    <div class="absolute z-dropdown w-full mt-1 bg-white border border-gray-200 rounded-md shadow-dropdown max-h-60 overflow-auto animate-fade-in">

      <!-- Search input -->
      @if (searchable()) {
        <div class="p-2 border-b border-gray-100">
          <input
            type="text"
            [value]="searchQuery()"
            (input)="searchQuery.set($any($event.target).value)"
            placeholder="Search..."
            class="w-full px-3 py-1.5 text-sm border border-gray-200 rounded-md focus:outline-none focus:border-primary-500 focus:ring-1 focus:ring-primary-500/20" />
        </div>
      }

      <!-- Options list -->
      <ul role="listbox" class="py-1">
        @for (option of getFilteredOptions(); track option.value) {
          <li
            role="option"
            [attr.aria-selected]="isSelected(option)"
            [class]="'px-3 py-2 cursor-pointer transition-colors ' +
                     (option.disabled ? 'text-gray-300 cursor-not-allowed' :
                      isSelected(option) ? 'bg-primary-50 text-primary-700' :
                      'hover:bg-gray-50 text-gray-800')"
            (click)="selectOption(option)">

            <span class="flex items-center justify-between">
              <span>{{ option.label }}</span>

              @if (isSelected(option)) {
                <span class="material-icons text-primary-600 text-lg">check</span>
              }
            </span>
          </li>
        }

        @if (getFilteredOptions().length === 0) {
          <li class="px-3 py-2 text-gray-400 text-sm">
            No options found
          </li>
        }
      </ul>
    </div>
  }

  <!-- Error message -->
  @if (error()) {
    <p class="mt-1.5 text-sm text-danger-500" role="alert">
      {{ error() }}
    </p>
  }
</div>
